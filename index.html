<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第5回あべはんカップ卓球大会 申込システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 高齢者にも見やすいように全体的に少し大きめのフォントを設定 */
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .hidden { display: none !important; }
        .btn {
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background-color: #2563eb; color: white; }
        .btn-primary:hover { background-color: #1d4ed8; }
        .btn-secondary { background-color: #6b7280; color: white; }
        .btn-secondary:hover { background-color: #4b5563; }
        .btn-danger { background-color: #ef4444; color: white; }
        .btn-danger:hover { background-color: #dc2626; }
        .btn-success { background-color: #10b981; color: white; }
        .btn-success:hover { background-color: #059669; }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            background-color: white;
        }
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        .label-req {
            color: #ef4444;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
            background-color: #fee2e2;
            padding: 0.1rem 0.4rem;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>

    <!-- ヘッダー -->
    <header class="bg-blue-800 text-white shadow-md sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold">第5回あべはんカップ</h1>
            <button id="navAdminBtn" class="text-sm bg-blue-700 hover:bg-blue-600 px-3 py-1 rounded" onclick="app.navigate('admin-login')">管理者</button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8 mb-20">
        
        <!-- ==================== 1. ホーム画面 ==================== -->
        <section id="page-home" class="page-section">
            <div class="bg-white rounded-xl shadow-md p-6 mb-8 border-t-4 border-blue-600">
                <h2 class="text-2xl font-bold mb-4 text-center">大会概要</h2>
                <div class="space-y-3 text-lg">
                    <p><strong>開催日：</strong> 2026年5月23日（土）、24日（日）</p>
                    <p><strong>会場：</strong> 二戸市総合スポーツセンター</p>
                    <div class="bg-yellow-50 p-4 rounded-lg text-sm md:text-base border border-yellow-200 mt-4">
                        <strong>【参加ルール】</strong><br>
                        同日の種目に重複して参加はできませんが、別日の種目（土曜と日曜それぞれ1種目ずつ）には参加可能です。
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <h2 class="text-xl font-bold mb-4 border-b-2 border-gray-200 pb-2">現在の申込状況</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 23日種目 -->
                    <div>
                        <h3 class="font-bold text-lg text-blue-700 mb-3 flex items-center">
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2 text-sm">5/23(土)</span>競技
                        </h3>
                        <ul id="statusListDay1" class="space-y-2">
                            <!-- JSで生成 -->
                        </ul>
                    </div>
                    <!-- 24日種目 -->
                    <div>
                        <h3 class="font-bold text-lg text-green-700 mb-3 flex items-center">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded mr-2 text-sm">5/24(日)</span>競技
                        </h3>
                        <ul id="statusListDay2" class="space-y-2">
                            <!-- JSで生成 -->
                        </ul>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <button onclick="app.startApplication()" class="btn btn-primary text-xl px-12 py-4 shadow-lg hover:shadow-xl w-full md:w-auto">
                    参加申し込みを始める
                </button>
            </div>
        </section>

        <!-- ==================== 2. 申込フォーム画面 ==================== -->
        <section id="page-form" class="page-section hidden">
            <div class="bg-white rounded-xl shadow-md p-4 md:p-8">
                <h2 class="text-2xl font-bold mb-6 text-center">参加申し込みフォーム</h2>
                
                <form id="entryForm" onsubmit="event.preventDefault(); app.goToConfirm();">
                    <!-- 代表者情報 -->
                    <div class="mb-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-bold mb-4 border-b pb-2">1. チーム・代表者情報</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block font-bold mb-1">チーム名 <span class="label-req">必須</span></label>
                                <input type="text" id="teamName" class="form-input" required placeholder="例: 二戸卓球クラブ">
                            </div>
                            <div>
                                <label class="block font-bold mb-1">代表者氏名 <span class="label-req">必須</span></label>
                                <input type="text" id="repName" class="form-input" required placeholder="例: 山田 太郎">
                            </div>
                            <div>
                                <label class="block font-bold mb-1">メールアドレス <span class="label-req">必須</span></label>
                                <input type="email" id="email" class="form-input" required placeholder="例: info@example.com">
                            </div>
                            <div>
                                <label class="block font-bold mb-1">電話番号 <span class="label-req">必須</span></label>
                                <input type="tel" id="phone" class="form-input" required placeholder="例: 090-1234-5678">
                            </div>
                        </div>
                    </div>

                    <!-- 選手情報 -->
                    <div class="mb-8">
                        <div class="flex justify-between items-end border-b pb-2 mb-4">
                            <h3 class="text-lg font-bold">2. 参加選手情報</h3>
                            <button type="button" onclick="app.addPlayerForm()" class="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200 font-bold">
                                ＋ 選手を追加
                            </button>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">※同日の種目に重複してエントリーすることはできません。</p>
                        
                        <div id="playersContainer" class="space-y-6">
                            <!-- 選手入力フォームがここにJSで追加される -->
                        </div>
                    </div>

                    <!-- エラーメッセージ -->
                    <div id="formError" class="hidden bg-red-100 text-red-700 p-4 rounded-lg mb-6 font-bold text-center"></div>

                    <!-- ボタン -->
                    <div class="flex flex-col md:flex-row justify-center gap-4">
                        <button type="button" onclick="app.navigate('home')" class="btn btn-secondary px-8 py-3 w-full md:w-auto text-lg">戻る</button>
                        <button type="submit" class="btn btn-primary px-8 py-3 w-full md:w-auto text-lg">入力内容を確認する</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- ==================== 3. 申込確認画面 ==================== -->
        <section id="page-confirm" class="page-section hidden">
            <div class="bg-white rounded-xl shadow-md p-4 md:p-8">
                <h2 class="text-2xl font-bold mb-6 text-center">入力内容の確認</h2>
                <p class="text-center text-red-600 font-bold mb-6">まだ申し込みは完了していません。「この内容で申し込む」ボタンを押してください。</p>

                <div class="mb-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <h3 class="text-lg font-bold mb-4 border-b pb-2">チーム・代表者情報</h3>
                    <table class="w-full text-left border-collapse">
                        <tbody>
                            <tr class="border-b"><th class="py-2 w-1/3 text-gray-600">チーム名</th><td class="py-2 font-bold" id="confTeamName"></td></tr>
                            <tr class="border-b"><th class="py-2 text-gray-600">代表者氏名</th><td class="py-2 font-bold" id="confRepName"></td></tr>
                            <tr class="border-b"><th class="py-2 text-gray-600">メールアドレス</th><td class="py-2" id="confEmail"></td></tr>
                            <tr><th class="py-2 text-gray-600">電話番号</th><td class="py-2" id="confPhone"></td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="mb-8">
                    <h3 class="text-lg font-bold mb-4 border-b pb-2">参加選手</h3>
                    <div id="confPlayersContainer" class="space-y-4">
                        <!-- 確認用選手リストがここにJSで追加される -->
                    </div>
                </div>

                <div class="flex flex-col-reverse md:flex-row justify-center gap-4">
                    <button type="button" onclick="app.navigate('form')" class="btn btn-secondary px-8 py-4 w-full md:w-auto text-lg">修正する</button>
                    <button type="button" onclick="app.submitApplication()" class="btn btn-success px-8 py-4 w-full md:w-auto text-lg font-bold shadow-lg">この内容で申し込む</button>
                </div>
            </div>
        </section>

        <!-- ==================== 4. 申込完了画面 ==================== -->
        <section id="page-complete" class="page-section hidden text-center">
            <div class="bg-white rounded-xl shadow-md p-8 md:p-12">
                <div class="text-green-500 mb-6">
                    <svg class="w-24 h-24 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold mb-4 text-gray-800">お申し込みが完了しました</h2>
                <p class="text-lg text-gray-600 mb-8">
                    ご入力いただいた代表者メールアドレス宛に<br class="hidden md:inline">確認メールを送信しました。（※デモ機能のため実際には送信されません）<br>
                    大会当日はお気をつけてお越しください。
                </p>
                <button onclick="app.navigate('home')" class="btn btn-primary px-8 py-3 text-lg">トップページへ戻る</button>
            </div>
        </section>

        <!-- ==================== 5. 管理者ログイン ==================== -->
        <section id="page-admin-login" class="page-section hidden">
            <div class="max-w-md mx-auto bg-white rounded-xl shadow-md p-8">
                <h2 class="text-2xl font-bold mb-6 text-center">管理者ログイン</h2>
                <div class="mb-4 text-sm text-gray-600 bg-blue-50 p-3 rounded">
                    デモ用パスワードは <strong>admin</strong> です。
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block font-bold mb-1">パスワード</label>
                        <input type="password" id="adminPassword" class="form-input" placeholder="パスワードを入力">
                    </div>
                    <button onclick="app.adminLogin()" class="btn btn-primary w-full py-3 text-lg">ログイン</button>
                    <button onclick="app.navigate('home')" class="btn btn-secondary w-full py-3 text-lg mt-2">ホームに戻る</button>
                </div>
                <div id="adminLoginError" class="text-red-500 font-bold mt-4 text-center hidden">パスワードが違います</div>
            </div>
        </section>

        <!-- ==================== 6. 管理者ダッシュボード ==================== -->
        <section id="page-admin-dash" class="page-section hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">管理者ダッシュボード</h2>
                <button onclick="app.adminLogout()" class="btn btn-secondary px-4 py-2">ログアウト</button>
            </div>

            <!-- タブ -->
            <div class="flex border-b border-gray-300 mb-6 overflow-x-auto">
                <button onclick="app.switchAdminTab('entries')" id="tabBtnEntries" class="admin-tab-btn py-3 px-6 font-bold text-blue-600 border-b-2 border-blue-600 focus:outline-none whitespace-nowrap">申込一覧</button>
                <button onclick="app.switchAdminTab('settings')" id="tabBtnSettings" class="admin-tab-btn py-3 px-6 font-bold text-gray-500 hover:text-gray-700 focus:outline-none whitespace-nowrap">種目設定・受付停止</button>
            </div>

            <!-- 申込一覧タブ -->
            <div id="adminTabEntries" class="admin-tab-content bg-white rounded-xl shadow-md p-6">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">全申込データ (<span id="totalEntriesCount">0</span>件)</h3>
                    <div class="flex space-x-2 mt-4 md:mt-0">
                        <button onclick="app.downloadCSV()" class="btn btn-success px-4 py-2 text-sm flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            CSVダウンロード
                        </button>
                        <button onclick="app.clearAllData()" class="btn btn-danger px-4 py-2 text-sm">全データ削除</button>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-200 text-sm">
                        <thead class="bg-gray-100 border-b">
                            <tr>
                                <th class="py-3 px-4 text-left font-bold text-gray-600 uppercase">チーム/代表者</th>
                                <th class="py-3 px-4 text-left font-bold text-gray-600 uppercase">連絡先</th>
                                <th class="py-3 px-4 text-left font-bold text-gray-600 uppercase">選手情報</th>
                                <th class="py-3 px-4 text-center font-bold text-gray-600 uppercase w-24">操作</th>
                            </tr>
                        </thead>
                        <tbody id="adminEntriesList" class="divide-y divide-gray-200">
                            <!-- JSで生成 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 種目設定タブ -->
            <div id="adminTabSettings" class="admin-tab-content hidden bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold mb-6 border-b pb-2">種目ごとの受付ステータス管理</h3>
                <p class="text-sm text-gray-600 mb-6 bg-yellow-50 p-3 rounded">
                    受付を「停止中」にすると、参加者はその種目を選択できなくなります（定員到達時などに使用します）。
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="font-bold text-lg mb-4 text-blue-700">5/23(土) 競技</h4>
                        <div id="adminStatusDay1" class="space-y-3">
                            <!-- JSで生成 -->
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg mb-
